<!DOCTYPE html>
<html lang="en">
	<head>
    	<title>CLI</title>
    	<meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
        <style>
        	html {
                background-color: black;
                font-family: 'Courier Prime', sans-serif;
                user-select: none;
                margin: 0;
                margin-bottom: 50px;
                padding: 0;
                color: white;
            }
            #commandInputArea {
                display: inline;
                position: fixed;
                bottom: 0px;
                left: 0px;
                text-align: left;
                font-size: 24px;
                padding: 5px 10px;
                margin: 0;
                background-color: rgba(0,0,0/*,0.25*/);
                backdrop-filter: blur(5px);
                border-top: 0.5px solid white;
                /*border-radius: 30px;*/
                width: 100%;
            }
            .pastCommandArea {
                display: inline;
                top: 0px;
                text-align: left;
                font-size: 0.5px;
                /*padding: 2px;*/
                border: none;
                width: 90%;
                /*margin: 5px 5px;*/
            }
            .newOutput {
                display: inline-block;
                top: 0px;
                text-align: left;
                font-size: 24px;
                padding: 2px;
                border: none;
                width: 90%;
                margin: 0px 5px;
                /*border: 1px solid white;*/
            }
            #indicator {
                background-color: white;
                /*font-size: 24px;*/
                /*border-left: 0.05px solid red;
                border-bottom: 0.05px solid red;
                border-right: 0.05px solid lime;
                border-top: 0.05px solid lime;*/
            }
            .command-help {
                font-weight: bold;
            }
            .error {
                font-weight: bold;
            }
            .error span {
                font-weight: bold
            }
            #toptext {
                position: fixed;
                top: 0;
                right: 0;
                padding: 0px;
                margin: 5px;
                text-align: right;
                display: none;
            }
        </style>
    </head>
    <body>
        <p id="toptext"><span id="time"></span><br>CLI v<span id="versionOutput">1.0.0</span></p>
    	<p><span class="pastCommandArea"><span></span> <span id="output"></span></span></p>
    	<p id="commandInputArea"><span id="beginInput"></span><span id="activeCommand"></span><span id="commandInput"></span><span id="indicator">E</span></p>
    	<script>
        	const version = '1.4.0';
            const newHere = 'New Commands:<br>theme [theme] - Change the color scheme to a preset colors. <br>Preset names: hacker, powershell, cmd.<br>reset - Clear the screen and reset all settings.';

            let commandLine = '';
            let commandRequest;
            let commandOption;
            let processOutput;
            let pastCommand;
            let ans;
            let processPercent;
            let specialCharacter = false;
            let usrname = 'sysAdmin';
            let currentInput = '';

            let pastCommands = [];
            let pastRequests = -1;

            //var first = true;
            const html = document.querySelector('html');
            const versionOutput = document.getElementById('versionOutput');
            const commandInput = document.getElementById('commandInput');
            const activeCommand = document.getElementById('activeCommand');
            const indicator = document.getElementById('indicator');
            const output = document.getElementById('output');
            const input = '/#> '
            const activeInput = '//#> ';
            const customMenu = document.getElementById('customMenu');
            const costumMenuItems = document.querySelectorAll('.customMenuItems');
            const coordsOutput = document.getElementById('coordsOutput');
            const cursor = document.getElementById('cursor');
            const time = document.getElementById('time');
            const beginInput = document.getElementById('beginInput');
            var currentCommand = '';
            const error = 'UNKNOWN COMMAND';
            const toptext = document.getElementById('toptext');
            versionOutput.innerHTML = version;
            //runCommand();
            
            
            document.addEventListener('keydown', function(event) {
                // Define an array of excluded keys
                const excludedKeys = ['Tab', 'Control', 'Shift', 'Alt', 'Backspace', 'Enter', 'Meta', 'ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'F1', 'F2', 'F3', 'F4', 'F5', 'F6', 'F7', 'F8', 'F9', 'F10', 'F11', 'F12'  ];

                // Replace the condition with a simpler check
                if (!excludedKeys.includes(event.key)) {
                    if (currentCommand === 'calc' && commandLine.length === 0) {
                    if (['+', '-', '*', '/'].includes(event.key)) {
                        commandLine = String(ans);
                    } else if (event.key === 'r') {
                        specialCharacter = true;
                        commandLine = 'Round';
                    }
                    }
                    if (!specialCharacter) commandLine += event.key;
                    commandInput.innerHTML = commandLine;
                    specialCharacter = false;
                }
                if (event.key === 'Backspace') {
                    if (commandLine.length === 0) {
                        currentInput = '';
                        activeCommand.innerHTML = '';
                        currentCommand = '';
                        commandInput.innerHTML = '';
                        commandLine = '';
                    }
                    commandLine = commandLine.substring(0, commandLine.length - 1);
                    commandInput.innerHTML = commandLine;
                }
                if (event.ctrlKey && event.key === 'Backspace') {
                    pastRequests = -1;
                    commandInput.innerHTML = '';
                    commandLine = '';
                }
                if (event.key === 'Enter') {
                    //output.innerHTML = commandLine;
                    runCommand();
                }
            });
            document.addEventListener('keydown', function(event) {
                if (event.key === 'ArrowUp') {
                    //preventDefault();
                    if (pastRequests + 1 !== pastCommands.length) {
                        pastRequests++;
                        commandLine = pastCommands[pastRequests];
                        commandInput.innerHTML = commandLine;
                    }
                } else if (event.key === 'ArrowDown') {
                    if (pastRequests !== -1) {
                        if (pastRequests - 1 !== -1) {
                            pastRequests--;
                            commandLine = pastCommands[pastRequests];
                            commandInput.innerHTML = commandLine;
                        }
                    }
                }
            });

            function runCommand() {
                pastCommands.unshift(commandLine);
                console.log(pastCommands);

                pastRequests = -1;
                
                let commandOptions = commandLine.split(' ');
                commandRequest = commandOptions[0];
                commandOptions.shift();
                output.innerHTML = '<span style="font-weight: bold;">' + usrname + input + currentCommand + currentInput + '</span>' + commandLine;
                newLine();
                //alert(commandRequest);
                //alert(commandOption);
                /*if (commandLine.split(' ')[0] === 'echo') {
                        //output.innerHTML = commandLine.split(' ')[1];
                        //alert(commandLine.split(' ')[0]);
                    }*/
                    
                // CHECK FOR ACTIVE COMMANDS
                if (activeCommand.length !== 0) {
                    runActive();
                    //return;
                }

                //COMPLEX COMMANDS
                switch (commandRequest) {
                    case 'q':
                        clear();
                        break;
                    case 'clear':
                        clear();
                        break;
                    case 'calc':
                        currentInput = activeInput;
                        activeCommand.innerHTML = commandLine + currentInput;
                        currentCommand = 'calc';
                        break;
                    /*case 'falc':
                        activeCommand.innerHTML = commandLine + activeInput;
                        currentCommand = 'falc';
                        break;*/
                    case 'usrname':
                        if (!commandOptions[0]) {
                            output.innerHTML = 'Syntax incorrect<br>Usage: usrname [new username]';
                        } else {
                            usrname = commandOptions[0];
                            usrname.innerHTML = usrname;
                            output.innerHTML = 'Username changed to ' + usrname;
                            updateUsrname();
                        }
                        break;
                    case 'txt':
                        currentInput = activeInput;
                        activeCommand.innerHTML = commandLine + currentInput;
                        currentCommand = 'txt';
                        break;
                    case 'script':
                        currentInput = activeInput;
                        activeCommand.innerHTML = commandLine + currentInput;
                        currentCommand = 'script';
                        break;
                    case 'AItest-beta#1':
                        currentInput = activeInput;
                        activeCommand.innerHTML = commandLine + currentInput;
                        output.innerHTML = 'Welcome to EthaNet AI v0.1.25';
                        currentCommand = 'AItest';
                        break;
                    case 'help-me':
                        document.body.style.color = 'black';
                        document.body.style.fontFamily = 'sans-serif';
                        document.body.innerHTML = '<span style="user-select: text;">Error loading content.</span>';
                        document.body.style.cursor = 'text';
                        document.querySelector('html').style.backgroundColor = 'white';
                        break;
                    case 'help':
                        output.innerHTML = '<span class="command-help">calc</span> - Perform calculations';
                        newLine();
                        //output.innerHTML = '<span class="command-help">falc</span> - Perform false calculations';
                        //newLine();
                        //output.innerHTML = '<span class="command-help">AItest-beta#1</span> - Test the 1st beta of an AI made by Ethan Severy';
                        //newLine();
                        output.innerHTML = '<span class="command-help">sysinfo</span> - See specifications of current device';
                        newLine();
                        output.innerHTML = '<span class="command-help">txt</span> - Repeats whatever you type in the Command Line';
                        newLine();
                        output.innerHTML = '<span class="command-help">script</span> - Run Javascript through the Command Line';
                        newLine();
                        output.innerHTML = '<span class="command-help">dnt</span> - Display current date and time';
                        newLine();
                        output.innerHTML = '<span class="command-help">version</span> - Display the version number of program';
                        newLine();
                        output.innerHTML = '<span class="command-help">usrname</span> - Change your username';
                        newLine();
                        output.innerHTML = '<span class="command-help">color</span> - Change the color of text and background';
                        newLine();
                        output.innerHTML = '<span class="command-help">resetcolor</span> - Reset the colors back to default';
                        newLine();
                        output.innerHTML = '<span class="command-help">version</span> - displays the program version';
                        newLine();
                        //output.innerHTML = '<span class="command-help">whatsnew</span> - displays what is new in the program';
                        //newLine();
                        output.innerHTML = '<span class="command-help">q</span> or <span class="command-help">clear</span> - Clears all output text';
                        break;
                    case 'sysinfo':
                        output.innerHTML = navigator.userAgent;
                        newLine();
                        output.innerHTML = navigator.platform;
                        newLine();
                        output.innerHTML = navigator.deviceMemory + 'GB RAM';
                        newLine();
                        output.innerHTML = navigator.language;
                        newLine();
                        output.innerHTML = screen.width + 'x' + screen.height;
                        break;
                    case 'dnt':
                        const now = new Date();
                        const options = {
                            weekday: 'long',
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit',
                            second: '2-digit',
                            timeZoneName: 'short'
                        };
                        const formattedDateTime = now.toLocaleString(undefined, options);
                        output.innerHTML = formattedDateTime;
                        break; 
                    case 'runAll':
                        // command is broken
                        commandLine = 'help';
                        runCommand();
                        commandLine = 'specs';
                        runCommand();
                        commandLine = 'dnt';
                        runCommand();
                        break;
                    case 'update':
                        loading();
                        setTimeout(function() {
                            loading();
                        }, 200);
                        break;
                    case 'color':
                        html.style.color = commandOptions[0];
                        indicator.style.backgroundColor = commandOptions[0];
                        html.style.backgroundColor = commandOptions[1];
                        commandInputArea.style.backgroundColor = commandOptions[1];
                        commandInputArea.style.borderColor = commandOptions[0];
                        if (!commandOptions[0]) {
                            output.innerHTML = 'Syntax incorrect<br>Usage: color [text color] [background color]';
                        }
                        break;
                    case 'theme':
                        switch (commandOptions[0]) {
                            case 'hacker':
                                html.style.color = '#00FF00';
                                indicator.style.backgroundColor = '#00FF00';
                                html.style.backgroundColor = 'black';
                                commandInputArea.style.backgroundColor = 'black';
                                commandInputArea.style.borderColor = '#00FF00';
                                break;
                            case 'powershell':
                                html.style.color = 'white';
                                indicator.style.backgroundColor = 'white';
                                html.style.backgroundColor = '#000080';
                                commandInputArea.style.backgroundColor = '#000080';
                                commandInputArea.style.borderColor = 'white';
                                break;
                            case 'cmd':
                                html.style.color = 'white';
                                indicator.style.backgroundColor = 'white';
                                html.style.backgroundColor = 'black';
                                commandInputArea.style.backgroundColor = 'black';
                                commandInputArea.style.borderColor = 'white';
                                break;
                        } if (!commandOptions[0]) {
                            output.innerHTML = 'Syntax incorrect<br>Usage: theme [theme name]<br>Preset names: hacker, powershell, cmd';
                        }
                        break;
                    case 'resetcolor':
                        resetColor();
                        break;
                    case 'reset':
                        reset();
                        break;
                    case 'showtime':
                        if (commandOptions[0] === 'true') toptext.style.display = 'block';
                        else if (commandOptions[0] === 'false') toptext.style.display = 'none';
                        break;
                    case 'whatsnew':
                        output.innerHTML = '<span style="font-weight: bold">' + version + ': </span>' + newHere;
                        break;
                    case 'version':
                        output.innerHTML = 'CLI v' + version;
                        break;
                    case 'about':
                        output.innerHTML = 'CLI is a web-based command line interface created by Ethan Severy. It is currently in early development and has many bugs. It is made for fun and to practice programming.';
                        break;
                    default:
                        if (commandLine !== '') output.innerHTML = error;
                }

                // OUTPUT
                commandLine = '';
                commandInput.innerHTML = '';
                if (output.innerHTML !== '') {
                    newLine();
                }
                document.querySelector('html').scrollTo(0, document.querySelector('html').scrollHeight);
            }
            function runActive() {
                if (currentCommand === 'calc') {
                    // Check for special conditions
                    if (commandLine === 'Round') {
                        ans = Math.round(ans);
                    } else { ans = eval(commandLine); }

                    //Output
                    output.innerHTML = ans;
                    commandLine = '';
                    commandInput.innerHTML = '';
                    //newLine();
                } else if (currentCommand === 'falc') {
                    output.innerHTML = eval(commandLine) + Math.floor(Math.random() * 100);
                    commandLine = '';
                    commandInput.innerHTML = '';
                    //newLine();
                } else if (currentCommand === 'txt') {
                    output.innerHTML = commandLine;
                    commandLine = '';
                    commandInput.innerHTML = '';
                    //newLine();
                } else if (currentCommand === 'AItest') {
                    commandLine = '';
                    commandInput.innerHTML = '';
                    //newLine();
                } else if (currentCommand === 'script') {
                    output.innerHTML = eval(commandLine);
                    if (output.innerHTML === 'undefined') {
                        output.innerHTML = commandLine;
                    }
                    commandLine = '';
                    commandInput.innerHTML = '';
                    //newLine();
                } else if (currentCommand === 'usrname') {
                    activeCommand.innerHTML = '';
                    currentCommand = '';
                    commandInput.innerHTML = '';
                }
            }
            document.addEventListener('keydown', function(event) {
                if (event.ctrlKey && event.key === 'x') {
                    event.preventDefault();
                    activeCommand.innerHTML = '';
                    currentCommand = '';
                    commandInput.innerHTML = '';
                    commandLine = '';
                }
            });
            function newLine() {
                const newParagraph = document.createElement('p');
                var oldText = document.getElementById('output').innerHTML;
                newParagraph.classList.add('newOutput');
                newParagraph.innerHTML = oldText;
                document.body.appendChild(newParagraph);
                output.innerHTML = '';
                document.querySelector('html').scrollTo(0, document.querySelector('html').scrollHeight);
            }
            function indicatorAnimation() {
                indicator.style.opacity = 0;
                setTimeout(function() {
                    indicator.style.opacity = 1;
                    setTimeout(indicatorAnimation, 500);
                }, 500);
            }
            indicatorAnimation();
            function loading() {
                setTimeout(function() {
                    output.innerHTML += '-';
                }, 100);
            }
            function timeUpdate() {
                const now = new Date();
                const options = {
                    month: '2-digit',
                    day: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                };
                const formattedDateTime = now.toLocaleString(undefined, options);
                time.innerHTML = formattedDateTime;
                setTimeout(timeUpdate, 100);
            }
            timeUpdate();

            function exit() {
                window.close();
            }
            function clear() {
                const elementsToRemove = document.querySelectorAll('p.newOutput');
                elementsToRemove.forEach(element => {
                    element.remove();
                });
            }
            function resetColor() {
                html.style.color = 'white';
                indicator.style.backgroundColor = 'white';
                html.style.backgroundColor = 'black';
                commandInputArea.style.backgroundColor = 'black';
                commandInputArea.style.borderColor = 'white';
            }
            function updateUsrname() {
                beginInput.innerHTML = usrname + input;
            }
            updateUsrname();
            function reset() {
                output.innerHTML = 'Resetting...';
                setTimeout(function() {
                    clear();
                    resetColor();
                    html.style.fontFamily = 'Courier Prime', sans-serif;
                }, 500);
            }
        </script>
    </body>
</html>
